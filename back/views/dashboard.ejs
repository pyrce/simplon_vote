<!DOCTYPE html>
<html lang="en">
<head>
    <% include ./partials/head %>
</head>
<body class="container">

  <header>
    <% include partials/header %>
  </header>

  <main>
    <div class="row">
      <div class="col-md-12"> <div class="msg"></div>
        <div class="card">
          <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs">
              <li class="nav-item">
                <a class="nav-link <% if (type=="all") { %>active <% }%>" href="/dashboard/showall">tous les sujets</a>
              </li>
              <li class="nav-item">
                <a class="nav-link <% if (type=="mine") { %>active <% }%>" href="/dashboard/showmine">mes sujets</a>
              </li>
              <li class="nav-item">
                <a class="nav-link <% if (type=="part") { %>active <% }%>" href="/dashboard/part">mes
                  participations</a>
              </li>
              <li class="nav-item">
                <a class="nav-link <% if (type=="end") { %>active <% }%>" href="/dashboard/showend">vote terminé</a>
              </li>
              <li class="nav-item">
                <a class="nav-link <% if (type=="progress") { %>active <% }%>" href="/dashboard/progress">vote en
                  cours</a>
              </li>
            </ul>
          </div>
      <% votes.forEach(function(vote) { %>
      <% if (vote.status == 'inprogress') { %>
      <div class="card" onclick="location.assign('/choix/<%= vote._id %>')" id="votes">
        <% }else{ %>
          <div class="card" id="votes" >
          <% } %>
          <div class="card-body">
            <p class="text-center"><b><%= vote.subject %></b> <br /> <small>By <% if (vote.createdBy != null) { %>
                <%= vote.createdBy.login %>
                <% } %></small></p>
            <p class="text-right"> <%= vote.participants.length %> / <%= vote.quota %> Participants <%if (!vote.participants.includes(locals.currentUser.id)){%> <button onclick="participer('<%=vote._id%>')" class="btn btn-info"><i class="fas fa-arrow-circle-right"></i> </button><%}%></p>
            <div class="progress">
              <% var vot= vote.participants.length/vote.quota*100 %>
              <div class="progress-bar bg-warning" role="progressbar" style="width: <%= vot %>%;"
                aria-valuenow="<%= vot %>" aria-valuemin="0" aria-valuemax="100"> <%= vot %>%</div>
            </div> </div>
          </div>
            <%})%>
          
        </div>
      <div class="row" data-pages="<%=pages%>" id="pages">

      </div>
  
  </div>
</main>
<script>

$( document ).ready(function() {
    var url=location.href
    var pages=$("#pages").data("pages");
    for(p=1;p<=pages+1;p++){
$("#pages").append('<a href="'+url+'/'+p+'" class="btn btn-primary mr-2"> '+p+'</a> ')
    }
});

  function participer(id){ 
$.ajax({
  url:"/votes/"+id,
  type:"PUT",
  headers: {"X-HTTP-Method-Override": "PUT"}
,success:function(msg){

if(msg=="OK"){
  $(".msg").show(100,"swing");
  $(".msg").html('<button type="button" id="validationpanier" class="btn btn-success">vous êtes bien inscris</button>');
  $(".msg").delay(4000).hide(50,"swing");
  $("#votes").load(" #votes > *")
}
}

})
  }

</script>

</body>
</html>